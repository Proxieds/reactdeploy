{"ast":null,"code":"import _asyncToGenerator from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/regenerator/index.js\";import*as React from'react';import Button from'@mui/material/Button';import Avatar from'@mui/material/Avatar';import List from'@mui/material/List';import ListItem from'@mui/material/ListItem';import ListItemAvatar from'@mui/material/ListItemAvatar';import ListItemText from'@mui/material/ListItemText';import DialogTitle from'@mui/material/DialogTitle';import Dialog from'@mui/material/Dialog';import PersonIcon from'@mui/icons-material/Person';import{blue}from'@mui/material/colors';import DeleteIcon from'@mui/icons-material/Delete';import'./CommentDialog.css';import{EditComment,AddCommentListItem}from'./AddComment';import requests from'../../requests';import{usePreviousProps}from'@mui/utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CommentDialogButton(props){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),open=_React$useState2[0],setOpen=_React$useState2[1];var _React$useState3=React.useState(0),_React$useState4=_slicedToArray(_React$useState3,2),comments=_React$useState4[0],setComments=_React$useState4[1];var _React$useState5=React.useState(0),_React$useState6=_slicedToArray(_React$useState5,2),commenters=_React$useState6[0],setCommenters=_React$useState6[1];var _React$useState7=React.useState(0),_React$useState8=_slicedToArray(_React$useState7,2),ids=_React$useState8[0],setCommentIds=_React$useState8[1];var getComments=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,ids,commenter_ids,comment_ids;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return requests.get(\"authors/\".concat(props.author_id,\"/posts/\").concat(props.post_id,\"/comments/\"),{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}},{withCredentials:true});case 3:response=_context.sent;console.log(response.data.items);ids=[];commenter_ids=[];comment_ids=[];response.data.items.forEach(function(comment){ids.push(comment.comment);commenter_ids.push(comment.author);comment_ids.push(comment.id);});setComments(ids);setCommenters(commenter_ids);setCommentIds(comment_ids);_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function getComments(){return _ref.apply(this,arguments);};}();React.useEffect(function(){getComments();},[]);var handleClickOpen=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setOpen(true);case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function handleClickOpen(){return _ref2.apply(this,arguments);};}();var handleClose=function handleClose(value){setOpen(false);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:handleClickOpen,children:\"View Comments\"}),/*#__PURE__*/_jsx(CommentDialog,{current_author:props.current_author,author_id:props.author_id,open:open,onClose:handleClose,post_id:props.post_id,comments:comments,commenters:commenters,comment_id:ids})]});}function CommentDialog(props){var authors=props.commenters?props.commenters:[];var comments=props.comments?props.comments:[];var onClose=props.onClose,selectedValue=props.selectedValue,open=props.open;var _React$useState9=React.useState(\"\"),_React$useState10=_slicedToArray(_React$useState9,2),commentText=_React$useState10[0],setCommentText=_React$useState10[1];var handleClose=function handleClose(){onClose(selectedValue);};// Handles the deletion of a comment within the dialog listview after confirmation\nvar handleDelete=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(index){var comment_id,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!window.confirm(\"Do you really want to delete this comment?\")){_context3.next=11;break;}_context3.prev=1;comment_id=props.comment_id[index];_context3.next=5;return requests.delete(\"authors/\".concat(props.author_id,\"/posts/\").concat(props.post_id,\"/comments/\").concat(comment_id,\"/\"),{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}},{withCredentials:true});case 5:response=_context3.sent;_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](1);console.log(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[1,8]]);}));return function handleDelete(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Dialog,{onClose:handleClose,maxWidth:\"800px\",open:open,children:[/*#__PURE__*/_jsx(DialogTitle,{className:\"comment-dialog\",children:\"Comments\"}),/*#__PURE__*/_jsxs(List,{sx:{pt:0},children:[authors.map(function(author,index){return/*#__PURE__*/_jsxs(ListItem,{button:true,children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:blue[100],color:blue[600]},children:/*#__PURE__*/_jsx(PersonIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(author,\": \").concat(comments[index])}),author===props.current_author?/*#__PURE__*/_jsx(EditComment,{current_author:props.current_author,post_author:props.author_id,post_id:props.post_id,comment_id:props.comment_id[index]}):'',author===props.current_author?/*#__PURE__*/_jsx(Button,{className:\"comment-button\",color:\"error\",variant:\"contained\",startIcon:/*#__PURE__*/_jsx(DeleteIcon,{}),onClick:function onClick(){return handleDelete(index);},children:\"Delete\"}):'']},author);}),/*#__PURE__*/_jsx(AddCommentListItem,{current_author:props.current_author,post_author:props.author_id,post_id:props.post_id})]})]});}","map":{"version":3,"sources":["/Users/victorlieu/Desktop/Development/reactdeploy/frontend/src/components/Posts/CommentDialog.js"],"names":["React","Button","Avatar","List","ListItem","ListItemAvatar","ListItemText","DialogTitle","Dialog","PersonIcon","blue","DeleteIcon","EditComment","AddCommentListItem","requests","usePreviousProps","CommentDialogButton","props","useState","open","setOpen","comments","setComments","commenters","setCommenters","ids","setCommentIds","getComments","get","author_id","post_id","headers","Authorization","localStorage","getItem","accept","withCredentials","response","console","log","data","items","commenter_ids","comment_ids","forEach","comment","push","author","id","useEffect","handleClickOpen","handleClose","value","current_author","CommentDialog","authors","onClose","selectedValue","commentText","setCommentText","handleDelete","index","window","confirm","comment_id","delete","pt","map","bgcolor","color"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from '@mui/material/Button';\nimport Avatar from '@mui/material/Avatar';\nimport List from '@mui/material/List';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemAvatar from '@mui/material/ListItemAvatar';\nimport ListItemText from '@mui/material/ListItemText';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport Dialog from '@mui/material/Dialog';\nimport PersonIcon from '@mui/icons-material/Person';\nimport { blue } from '@mui/material/colors';\nimport DeleteIcon from '@mui/icons-material/Delete'\nimport './CommentDialog.css';\nimport {EditComment, AddCommentListItem} from './AddComment';\nimport requests from '../../requests';\nimport { usePreviousProps } from '@mui/utils';\n\nexport default function CommentDialogButton(props) {\n  const [open, setOpen] = React.useState(false);\n  const [comments, setComments] = React.useState(0);\n  const [commenters, setCommenters] = React.useState(0);\n  const [ids, setCommentIds] = React.useState(0); \n\n  const getComments = async () => {\n    try {\n      const response = await requests.get(`authors/${props.author_id}/posts/${props.post_id}/comments/`,\n      {headers: {\n      Authorization: localStorage.getItem('access_token'),\n      accept: 'application/json',\n      }},\n      {withCredentials:true});\n      console.log(response.data.items);\n      var ids = [];\n      var commenter_ids = [];\n      var comment_ids = [];\n      response.data.items.forEach((comment) =>  {\n        ids.push(comment.comment);\n        commenter_ids.push(comment.author);\n        comment_ids.push(comment.id);\n      });\n      setComments(ids);\n      setCommenters(commenter_ids);\n      setCommentIds(comment_ids);\n    }\n    catch(error) {\n      console.log(error);\n    }\n  };\n\n  React.useEffect(() => {\n    getComments();\n  }, []);\n\n\nconst handleClickOpen = async () => {\n    setOpen(true);\n};\n\n  const handleClose = (value) => {\n    setOpen(false);\n  };\n\n  return (\n    <div>\n      <Button variant=\"outlined\" onClick={handleClickOpen}>\n        View Comments\n      </Button>\n      <CommentDialog\n        current_author = {props.current_author}\n        author_id = {props.author_id}\n        open={open}\n        onClose={handleClose}\n        post_id = {props.post_id}\n        comments = {comments}\n        commenters = {commenters}\n        comment_id = {ids}\n      />\n    </div>\n  );\n}\n\nfunction CommentDialog(props) {\n\n  var authors = props.commenters ? props.commenters : [];\n  var comments = props.comments ? props.comments : [];\n  const { onClose, selectedValue, open } = props;\n  const [commentText, setCommentText] = React.useState(\"\")\n\n  const handleClose = () => {\n    onClose(selectedValue);\n  };\n\n  // Handles the deletion of a comment within the dialog listview after confirmation\n  const handleDelete = async (index) => {\n    // TODO switch to an actual confirm dialogue\n    if (window.confirm(\"Do you really want to delete this comment?\")) {\n    try {\n      var comment_id = props.comment_id[index]\n      const response = await requests.delete(`authors/${props.author_id}/posts/${props.post_id}/comments/${comment_id}/`,\n      {headers: {\n      Authorization: localStorage.getItem('access_token'),\n      accept: 'application/json',\n      }},\n      {withCredentials:true});\n    }\n    catch(error) {\n      console.log(error);\n    }\n  }\n}\n\n  return (\n    <Dialog onClose={handleClose} maxWidth=\"800px\" open={open}>\n      <DialogTitle className=\"comment-dialog\">Comments</DialogTitle>\n      <List sx={{ pt: 0 }}>\n        {authors.map((author, index) => (\n          <ListItem button key={author}>\n            <ListItemAvatar>\n              <Avatar sx={{ bgcolor: blue[100], color: blue[600] }}>\n                <PersonIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary={`${author}: ${comments[index]}`} />\n            {author === props.current_author ? \n            <EditComment\n              current_author = {props.current_author}\n              post_author = {props.author_id}\n              post_id = {props.post_id}\n              comment_id = {props.comment_id[index]}/> : ''}\n            {author === props.current_author ? <Button className = \"comment-button\" color = \"error\" variant=\"contained\" startIcon={<DeleteIcon />} onClick={() => handleDelete(index)}>\n              Delete\n            </Button> : ''}\n          </ListItem>\n        ))}\n        <AddCommentListItem\n        current_author = {props.current_author}\n        post_author = {props.author_id}\n        post_id = {props.post_id}/>\n      </List>\n    </Dialog>\n  );\n}\n\nCommentDialog.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  open: PropTypes.bool.isRequired\n};"]},"metadata":{},"sourceType":"module"}