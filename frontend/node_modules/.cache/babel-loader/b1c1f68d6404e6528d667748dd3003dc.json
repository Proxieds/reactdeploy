{"ast":null,"code":"import _asyncToGenerator from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React from\"react\";import requests from\"../../requests\";import{Alert,Button,List,Grid,Box,TextField,Stack,ListItemText}from\"@mui/material\";import FollowRequest from\"../Followers/FollowRequest\";import LikeNotification from\"./LikeNotification\";import CommentNotification from\"./CommentNotification\";import Post from\"./Post\";import DeleteIcon from'@mui/icons-material/Delete';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Inbox=/*#__PURE__*/function(_React$Component){_inherits(Inbox,_React$Component);var _super=_createSuper(Inbox);function Inbox(props){var _this;_classCallCheck(this,Inbox);_this=_super.call(this,props);_this.initializeDetails=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,response_inbox,inboxPromises,inboxList;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return requests.get('get-user/',{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}});case 3:response=_context2.sent;_this.setState({currentUser:{id:response.data.id?response.data.id:'',url:response.data.url?response.data.url:'',host:response.data.host?response.data.host:'',displayName:response.data.displayName?response.data.displayName:'',github:response.data.github?response.data.github:'',profileImage:response.data.profileImage?response.data.profileImage:''}});_context2.next=7;return requests.get(\"authors/\".concat(_this.state.currentUser.id,\"/inbox/\"),{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}},{withCredentials:true});case 7:response_inbox=_context2.sent;// get list of likes for each post\ninboxPromises=response_inbox.data.items.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(item){var _response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(item.type==='post')){_context.next=7;break;}_context.next=3;return requests.get(\"authors/\".concat(item.author.id,\"/posts/\").concat(item.id,\"/likes/\"));case 3:_response=_context.sent;item.likes=_response.data.items;item.likedByCurrent=false;// check if current viewer liked the post\nitem.likes.forEach(function(like){if(like.author===_this.state.currentUser.id){item.likedByCurrent=true;}});case 7:return _context.abrupt(\"return\",item);case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());// wait for promises then set inbox list\n_context2.next=11;return Promise.all(inboxPromises);case 11:inboxList=_context2.sent;_this.setState({inboxList:inboxList});_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,15]]);}));_this.clearInbox=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return requests.delete(\"authors/\".concat(_this.state.currentUser.id,\"/inbox/\"),{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}},{withCredentials:true});case 3:_this.setState({inboxList:[]});_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));_this.state={currentUser:{},inboxList:[]};return _this;}_createClass(Inbox,[{key:\"componentDidMount\",value:function componentDidMount(){this.initializeDetails();}},{key:\"renderInboxItems\",value:function renderInboxItems(){var _this2=this;return this.state.inboxList.map(function(item){if(item.type==='post'){return/*#__PURE__*/_jsx(Grid,{item:true,xs:8,children:/*#__PURE__*/_jsx(Post,{post:item,currentUser:_this2.state.currentUser,likes:item.likes,likedByCurrent:item.likedByCurrent,isPublic:item.visibility==='PUBLIC'&&item.viewableBy===''})});}else if(item.type==='Follow'){return/*#__PURE__*/_jsx(Grid,{item:true,xs:8,children:/*#__PURE__*/_jsx(FollowRequest,{displayName:item.actor.displayName,profileImage:item.actor.profileImage,currentUserId:_this2.state.currentUser.id,id:item.actor.id,accepted:item.accepted})});}else if(item.type==='Like'){return/*#__PURE__*/_jsx(Grid,{item:true,xs:8,children:/*#__PURE__*/_jsx(LikeNotification,{summary:item.summary,profileImage:item.author.profileImage,object:item.object})});}else if(item.type==='comment'){return/*#__PURE__*/_jsx(Grid,{item:true,xs:8,children:/*#__PURE__*/_jsx(CommentNotification,{profileImage:item.author.profileImage,displayName:item.author.displayName,owned:item.author.id===_this2.state.currentUser.id,id:item.id})});}});}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"div\",{className:\"inbox\",children:[/*#__PURE__*/_jsx(Grid,{container:true,p:2,justifyContent:\"center\",alignItem:\"center\",direction:\"column\",children:/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(DeleteIcon,{}),onClick:this.clearInbox,children:\"Clear inbox\"})}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,justifyContent:\"center\",alignItem:\"center\",children:this.state.inboxList.length?this.renderInboxItems():/*#__PURE__*/_jsx(\"h2\",{children:\"Inbox is empty\"})})]});}}]);return Inbox;}(React.Component);export default Inbox;","map":{"version":3,"sources":["/Users/victorlieu/Desktop/Development/reactdeploy/frontend/src/components/Inbox/Inbox.js"],"names":["React","requests","Alert","Button","List","Grid","Box","TextField","Stack","ListItemText","FollowRequest","LikeNotification","CommentNotification","Post","DeleteIcon","Inbox","props","initializeDetails","get","headers","Authorization","localStorage","getItem","accept","response","setState","currentUser","id","data","url","host","displayName","github","profileImage","state","withCredentials","response_inbox","inboxPromises","items","map","item","type","author","likes","likedByCurrent","forEach","like","Promise","all","inboxList","console","log","clearInbox","delete","visibility","viewableBy","actor","accepted","summary","object","length","renderInboxItems","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport requests from \"../../requests\";\nimport { Alert, Button, List, Grid, Box, TextField, Stack, ListItemText } from \"@mui/material\";\nimport FollowRequest from \"../Followers/FollowRequest\";\nimport LikeNotification from \"./LikeNotification\";\nimport CommentNotification from \"./CommentNotification\";\nimport Post from \"./Post\";\nimport DeleteIcon from '@mui/icons-material/Delete';\n\n  \nclass Inbox extends React.Component {\n  constructor(props){\n    super(props);\n    this.state = {\n        currentUser: {},\n        inboxList: [],\n    }\n}\n\n  componentDidMount() {\n      this.initializeDetails();\n  }\n\n  initializeDetails = async () => {\n      try {\n          // Get the author details\n          const response = await requests.get('get-user/', {headers: {\n              Authorization: localStorage.getItem('access_token'),\n              accept: 'application/json',\n          }});\n\n          this.setState({ currentUser: {\n            id: response.data.id ? response.data.id : '',\n            url: response.data.url ? response.data.url : '',\n            host: response.data.host ? response.data.host : '',\n            displayName: response.data.displayName ? response.data.displayName : '',\n            github: response.data.github ? response.data.github : '',\n            profileImage: response.data.profileImage ? response.data.profileImage : ''\n          }});\n\n          const response_inbox = await requests.get(`authors/${this.state.currentUser.id}/inbox/`,\n            {headers: {\n              Authorization: localStorage.getItem('access_token'),\n              accept: 'application/json',\n              }},\n              {withCredentials:true})\n\n\n          // get list of likes for each post\n          const inboxPromises = response_inbox.data.items.map(async (item) => {\n            if (item.type === 'post') {\n              const response = await requests.get(`authors/${item.author.id}/posts/${item.id}/likes/`);\n              item.likes = response.data.items;\n              item.likedByCurrent = false;\n              // check if current viewer liked the post\n              item.likes.forEach((like) => {\n                if (like.author === this.state.currentUser.id) {\n                  item.likedByCurrent = true;\n                }\n              })\n            }\n            return item;\n          })\n          // wait for promises then set inbox list\n          const inboxList = await Promise.all(inboxPromises)\n          this.setState({inboxList: inboxList})\n      } catch(error) {\n          console.log(error)\n      }\n  }\n\n  clearInbox = async () => {\n    try {\n      await requests.delete(`authors/${this.state.currentUser.id}/inbox/`,\n            {headers: {\n              Authorization: localStorage.getItem('access_token'),\n              accept: 'application/json',\n              }},\n              {withCredentials:true})\n      this.setState({inboxList: []})\n    } catch(error) {\n        console.log(error)\n    }\n  }\n\n  renderInboxItems() {\n    return this.state.inboxList.map((item) => {\n        if (item.type === 'post') {\n          return (\n            <Grid item xs={8}>\n              <Post\n              post= {item}\n              currentUser={this.state.currentUser}\n              likes={item.likes}\n              likedByCurrent={item.likedByCurrent}\n              isPublic={item.visibility === 'PUBLIC' && item.viewableBy === ''}\n              />\n            </Grid>\n          );\n        } else if (item.type === 'Follow') {\n          return (\n            <Grid item xs={8}>\n            <FollowRequest\n                displayName={item.actor.displayName}\n                profileImage={item.actor.profileImage}\n                currentUserId={this.state.currentUser.id}\n                id={item.actor.id}\n                accepted={item.accepted}\n            />\n            </Grid>\n          );\n        } else if (item.type === 'Like') {\n          return (\n            <Grid item xs={8}>\n            <LikeNotification\n              summary={item.summary}\n              profileImage={item.author.profileImage}\n              object={item.object}\n            />\n            </Grid>\n          );\n        } else if (item.type === 'comment') {\n          return (\n          <Grid item xs={8}>\n            <CommentNotification\n              profileImage={item.author.profileImage}\n              displayName={item.author.displayName}\n              owned={item.author.id === this.state.currentUser.id}\n              id={item.id}\n            />\n            </Grid>);\n        }\n    });\n  }\n\n  render(){\n      return (\n          <div className=\"inbox\">\n            <Grid container p={2}\n            justifyContent=\"center\"\n            alignItem=\"center\"\n            direction=\"column\">\n              <Button \n              variant=\"outlined\"\n              startIcon={<DeleteIcon />}\n              onClick={this.clearInbox}>\n                Clear inbox\n              </Button>\n            </Grid>\n          <Grid container spacing={2} justifyContent=\"center\" alignItem=\"center\">\n            {this.state.inboxList.length ? this.renderInboxItems() : <h2>Inbox is empty</h2>}\n          </Grid>\n          </div>\n      )\n  }\n}\n\nexport default Inbox;\n"]},"metadata":{},"sourceType":"module"}