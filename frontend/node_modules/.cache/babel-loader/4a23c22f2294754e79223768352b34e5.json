{"ast":null,"code":"import _asyncToGenerator from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"/Users/victorlieu/Desktop/Development/reactdeploy/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{Component}from\"react\";// import './App.css';\nimport{Button,TextField,MenuItem,FormControl,FormGroup,Grid}from\"@mui/material\";import requests from\"../../requests\";import{Redirect}from\"react-router-dom\";import FileBase64 from\"react-file-base64\";// TODO: Add form validation\n//import { ValidatorForm, TextValidator } from \"react-material-ui-form-validator\";\n// TODOS:\n// Form validation\n// print error messages\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NewPost=/*#__PURE__*/function(_Component){_inherits(NewPost,_Component);var _super=_createSuper(NewPost);function NewPost(props){var _this;_classCallCheck(this,NewPost);_this=_super.call(this,props);_this.state={title:\"\",description:\"\",content_type:\"text/plain\",content:\"\",categories:\"\",visibility:\"PUBLIC\",unlisted:false,successful_post:false,author_id:\"\",viewableBy:\"\",jwt:localStorage.getItem(\"access_token\")};_this.getAuthorId=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return requests.get(\"get-user/\",{headers:{Authorization:_this.state.jwt,accept:\"application/json\"}});case 2:response=_context.sent;_this.setState({author_id:response.data.id?response.data.id:\"\"});case 4:case\"end\":return _context.stop();}}},_callee);}));_this.handleSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var url,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:requests.defaults.headers[\"Authorization\"]=_this.state.jwt;_context2.prev=1;url=\"authors/\"+_this.state.author_id+\"/posts/\";_context2.next=5;return requests.post(url,{headers:{accept:\"application/json\"},title:_this.state.title,author:_this.state.author_id,contentType:_this.state.content_type,content:_this.state.content,description:_this.state.description,visibility:_this.state.visibility,unlisted:_this.state.unlisted,categories:_this.state.categories,viewableBy:_this.state.viewableBy});case 5:response=_context2.sent;_this.setState({successful_post:true});response.data.type='post';if(!response.data.unlisted){_this.sendToSelf(response.data);_this.sendToFollowers(response.data);}_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[1,11]]);}));_this.sendToSelf=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(my_post){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return requests.post(\"authors/\".concat(_this.state.author_id,\"/inbox/\"),my_post,{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}},{withCredentials:true});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref3.apply(this,arguments);};}();_this.sendToFollowers=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(my_post){var response,followerList,index,follower;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return requests.get(\"authors/\".concat(my_post.author.id,\"/followers/\"));case 2:response=_context4.sent;followerList=response.data.items;// For each follower: send post to inbox\nindex=0;case 5:if(!(index<followerList.length)){_context4.next=12;break;}follower=followerList[index];_context4.next=9;return requests.post(\"authors/\".concat(follower.id,\"/inbox/\"),my_post,{headers:{Authorization:localStorage.getItem('access_token'),accept:'application/json'}},{withCredentials:true});case 9:++index;_context4.next=5;break;case 12:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2){return _ref4.apply(this,arguments);};}();_this.getAuthorId();return _this;}_createClass(NewPost,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsx(Grid,{container:true,justifyContent:\"center\",children:/*#__PURE__*/_jsxs(FormControl,{component:\"fieldset\",variant:\"filled\",disabled:true,style:{width:\"35em\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"New Post\"}),/*#__PURE__*/_jsxs(FormGroup,{children:[/*#__PURE__*/_jsx(TextField,{className:\"text-input\",size:\"small\",type:\"text\",fullWidth:true,label:\"Title\",value:this.state.title,onChange:function onChange(_ref5){var target=_ref5.target;return _this2.setState({title:target.value});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(TextField,{className:\"text-input\",size:\"small\",type:\"text\",fullWidth:true,label:\"Description\",value:this.state.description,onChange:function onChange(_ref6){var target=_ref6.target;return _this2.setState({description:target.value});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(TextField,{select:true,value:this.state.content_type,label:\"Content Type\",fullWidth:true,onChange:function onChange(_ref7){var target=_ref7.target;return _this2.setState({content_type:target.value});},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"text/plain\",children:\"text/plain\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"text/markdown\",children:\"text/markdown\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"application/base64\",children:\"application/base64\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"image/png;base64\",children:\"image/png\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"image/jpeg;base64\",children:\"image/jpeg\"})]}),/*#__PURE__*/_jsx(\"br\",{}),this.state.content_type===\"image/jpeg;base64\"||this.state.content_type===\"image/png;base64\"?/*#__PURE__*/_jsx(FileBase64,{className:\"image-input\",type:\"file\",accept:\".png,.jpeg,.jpg\",label:\"Content\",value:this.state.content,onDone:function onDone(_ref8){var base64=_ref8.base64;_this2.setState({// base64 includes data:image/png;base64, before content. So split.\ncontent:base64});}}):/*#__PURE__*/_jsx(TextField,{className:\"text-input\",size:\"medium\",multiline:true,type:\"text\",fullWidth:true,label:\"Content\",value:this.state.content,onChange:function onChange(_ref9){var target=_ref9.target;return _this2.setState({content:target.value});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(TextField,{className:\"text-input\",type:\"text\",label:\"Categories\",fullWidth:true,value:this.state.categories,onChange:function onChange(_ref10){var target=_ref10.target;return _this2.setState({categories:target.value});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{children:\"Visibility\"}),/*#__PURE__*/_jsxs(TextField,{select:true,fullWidth:true,value:this.state.visibility,label:\"Visibility\",defaultValue:\"PUBLIC\",onChange:function onChange(_ref11){var target=_ref11.target;return _this2.setState({visibility:target.value});},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"PUBLIC\",children:\"Public\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"FRIENDS\",children:\"Friends\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(TextField,{className:\"text-input\",defaultValue:\"\",size:\"small\",type:\"text\",fullWidth:true,label:\"Post only to\",value:this.state.viewableBy,onChange:function onChange(_ref12){var target=_ref12.target;return _this2.setState({viewableBy:target.value});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{children:\"Unlisted\"}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:this.state.unlisted,label:\"Unlisted\",onChange:function onChange(){return _this2.setState({unlisted:!_this2.state.unlisted});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:this.handleSubmit,ref:function ref(node){return _this2.btn=node;},children:\"Post\"}),this.state.successful_post&&/*#__PURE__*/_jsx(Redirect,{to:\"/inbox\"})]})]})});}}]);return NewPost;}(Component);export default NewPost;","map":{"version":3,"sources":["/Users/victorlieu/Desktop/Development/reactdeploy/frontend/src/components/Posts/NewPost.js"],"names":["React","Component","Button","TextField","MenuItem","FormControl","FormGroup","Grid","requests","Redirect","FileBase64","NewPost","props","state","title","description","content_type","content","categories","visibility","unlisted","successful_post","author_id","viewableBy","jwt","localStorage","getItem","getAuthorId","get","headers","Authorization","accept","response","setState","data","id","handleSubmit","defaults","url","post","author","contentType","type","sendToSelf","sendToFollowers","console","log","my_post","withCredentials","followerList","items","index","length","follower","width","target","value","base64","node","btn"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n// import './App.css';\nimport {\n  Button,\n  TextField,\n  MenuItem,\n  FormControl,\n  FormGroup,\n  Grid,\n} from \"@mui/material\";\nimport requests from \"../../requests\";\nimport { Redirect } from \"react-router-dom\";\nimport FileBase64 from \"react-file-base64\";\n// TODO: Add form validation\n//import { ValidatorForm, TextValidator } from \"react-material-ui-form-validator\";\n\n// TODOS:\n// Form validation\n// print error messages\n\nclass NewPost extends Component {\n  constructor(props) {\n    super(props);\n    this.getAuthorId();\n  }\n\n  state = {\n    title: \"\",\n    description: \"\",\n    content_type: \"text/plain\",\n    content: \"\",\n    categories: \"\",\n    visibility: \"PUBLIC\",\n    unlisted: false,\n    successful_post: false,\n    author_id: \"\",\n    viewableBy: \"\",\n    jwt: localStorage.getItem(\"access_token\"),\n  };\n\n  getAuthorId = async () => {\n    const response = await requests.get(\"get-user/\", {\n      headers: {\n        Authorization: this.state.jwt,\n        accept: \"application/json\",\n      },\n    });\n    this.setState({\n      author_id: response.data.id ? response.data.id : \"\",\n    });\n  };\n\n  handleSubmit = async () => {\n    requests.defaults.headers[\"Authorization\"] = this.state.jwt;\n    try {\n      const url = \"authors/\" + this.state.author_id + \"/posts/\";\n      const response = await requests.post(url, {\n        headers: {\n          accept: \"application/json\",\n        },\n        title: this.state.title,\n        author: this.state.author_id,\n        contentType: this.state.content_type,\n        content: this.state.content,\n        description: this.state.description,\n        visibility: this.state.visibility,\n        unlisted: this.state.unlisted,\n        categories: this.state.categories,\n        viewableBy: this.state.viewableBy,\n      });\n      this.setState({ successful_post: true });\n      response.data.type = 'post'\n      if (!response.data.unlisted) {\n        this.sendToSelf(response.data)\n        this.sendToFollowers(response.data);\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  sendToSelf = async (my_post) => {\n    await requests.post(\n      `authors/${this.state.author_id}/inbox/`,\n      my_post,\n      {headers: {\n        Authorization: localStorage.getItem('access_token'),\n        accept: 'application/json',\n      }},\n      {withCredentials:true});\n  };\n\n  sendToFollowers = async (my_post) => {\n    // Get Followers\n    const response = await requests.get(\n      `authors/${my_post.author.id}/followers/`\n    );\n    const followerList = response.data.items;\n\n    // For each follower: send post to inbox\n    for (let index = 0; index < followerList.length; ++index) {\n      const follower = followerList[index];\n      await requests.post(\n        `authors/${follower.id}/inbox/`,\n        my_post,\n        {headers: {\n          Authorization: localStorage.getItem('access_token'),\n          accept: 'application/json',\n        }},\n        {withCredentials:true});\n    }\n  };\n\n  render() {\n    return (\n      <Grid container justifyContent=\"center\">\n        <FormControl\n          component=\"fieldset\"\n          variant=\"filled\"\n          disabled\n          style={{ width: \"35em\" }}\n        >\n          <h1>New Post</h1>\n          <FormGroup>\n            <TextField\n              className=\"text-input\"\n              size=\"small\"\n              type=\"text\"\n              fullWidth={true}\n              label=\"Title\"\n              value={this.state.title}\n              onChange={({ target }) =>\n                this.setState({\n                  title: target.value,\n                })\n              }\n            />\n            <br />\n            <TextField\n              className=\"text-input\"\n              size=\"small\"\n              type=\"text\"\n              fullWidth={true}\n              label=\"Description\"\n              value={this.state.description}\n              onChange={({ target }) =>\n                this.setState({\n                  description: target.value,\n                })\n              }\n            />\n            <br />\n            <TextField\n              select\n              value={this.state.content_type}\n              label=\"Content Type\"\n              fullWidth={true}\n              onChange={({ target }) =>\n                this.setState({\n                  content_type: target.value,\n                })\n              }\n            >\n              <MenuItem value=\"text/plain\">text/plain</MenuItem>\n              <MenuItem value=\"text/markdown\">text/markdown</MenuItem>\n              <MenuItem value=\"application/base64\">application/base64</MenuItem>\n              <MenuItem value=\"image/png;base64\">image/png</MenuItem>\n              <MenuItem value=\"image/jpeg;base64\">image/jpeg</MenuItem>\n            </TextField>\n            <br />\n            {this.state.content_type === \"image/jpeg;base64\" ||\n            this.state.content_type === \"image/png;base64\" ? (\n              <FileBase64\n                className=\"image-input\"\n                type=\"file\"\n                accept=\".png,.jpeg,.jpg\"\n                label=\"Content\"\n                value={this.state.content}\n                onDone={({ base64 }) => {\n                  this.setState({\n                    // base64 includes data:image/png;base64, before content. So split.\n                    content: base64,\n                  });\n                }}\n              />\n            ) : (\n              <TextField\n                className=\"text-input\"\n                size=\"medium\"\n                multiline={true}\n                type=\"text\"\n                fullWidth={true}\n                label=\"Content\"\n                value={this.state.content}\n                onChange={({ target }) =>\n                  this.setState({\n                    content: target.value,\n                  })\n                }\n              />\n            )}\n            <br />\n            <TextField\n              className=\"text-input\"\n              type=\"text\"\n              label=\"Categories\"\n              fullWidth={true}\n              value={this.state.categories}\n              onChange={({ target }) =>\n                this.setState({\n                  categories: target.value,\n                })\n              }\n            />\n            <br />\n            <p>Visibility</p>\n            <TextField\n              select\n              fullWidth={true}\n              value={this.state.visibility}\n              label=\"Visibility\"\n              defaultValue=\"PUBLIC\"\n              onChange={({ target }) =>\n                this.setState({\n                  visibility: target.value,\n                })\n              }\n            >\n              <MenuItem value=\"PUBLIC\">Public</MenuItem>\n              <MenuItem value=\"FRIENDS\">Friends</MenuItem>\n            </TextField>\n            <br />\n            <TextField\n              className=\"text-input\"\n              defaultValue=\"\"\n              size=\"small\"\n              type=\"text\"\n              fullWidth={true}\n              label=\"Post only to\"\n              value={this.state.viewableBy}\n              onChange={({ target }) =>\n                this.setState({\n                  viewableBy: target.value,\n                })\n              }\n            />\n            <br />\n            <p>Unlisted</p>\n            <input \n              type='checkbox'\n              value={this.state.unlisted}\n              label=\"Unlisted\"\n              onChange={() =>\n                this.setState({\n                  unlisted: !this.state.unlisted,\n                })\n              }\n            />\n            <br />\n            <Button\n              variant=\"contained\"\n              onClick={this.handleSubmit}\n              ref={(node) => (this.btn = node)}\n            >\n              Post\n            </Button>\n            {this.state.successful_post && <Redirect to=\"/inbox\" />}\n          </FormGroup>\n        </FormControl>\n      </Grid>\n    );\n  }\n}\n\nexport default NewPost;\n"]},"metadata":{},"sourceType":"module"}